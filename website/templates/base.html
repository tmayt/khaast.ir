{% load static %}
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>خواست</title>
        <link href="{% static 'bootstrap.min.css' %}" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
        <link rel="apple-touch-icon" sizes="57x57" href="{% static 'pwa/apple-icon-57x57.png' %}">
        <link rel="apple-touch-icon" sizes="60x60" href="{% static 'pwa/apple-icon-60x60.png' %}">
        <link rel="apple-touch-icon" sizes="72x72" href="{% static 'pwa/apple-icon-72x72.png' %}">
        <link rel="apple-touch-icon" sizes="76x76" href="{% static 'pwa/apple-icon-76x76.png' %}">
        <link rel="apple-touch-icon" sizes="114x114" href="{% static 'pwa/apple-icon-114x114.png' %}">
        <link rel="apple-touch-icon" sizes="120x120" href="{% static 'pwa/apple-icon-120x120.png' %}">
        <link rel="apple-touch-icon" sizes="144x144" href="{% static 'pwa/apple-icon-144x144.png' %}">
        <link rel="apple-touch-icon" sizes="152x152" href="{% static 'pwa/apple-icon-152x152.png' %}">
        <link rel="apple-touch-icon" sizes="180x180" href="{% static 'pwa/apple-icon-180x180.png' %}">
        <link rel="icon" type="image/png" sizes="192x192"  href="{% static 'pwa/android-icon-192x192.png' %}">
        <link rel="icon" type="image/png" sizes="32x32" href="{% static 'pwa/favicon-32x32.png' %}">
        <link rel="icon" type="image/png" sizes="96x96" href="{% static 'pwa/favicon-96x96.png' %}">
        <link rel="icon" type="image/png" sizes="16x16" href="{% static 'pwa/favicon-16x16.png' %}">
        <link rel="manifest" href="{% static 'pwa/manifest.json' %}">
        <meta name="msapplication-TileColor" content="#0050a0">
        <meta name="msapplication-TileImage" content="{% static 'pwa/ms-icon-144x144.png' %}">
        <meta name="theme-color" content="#0050a0">

        {% block head %}{% endblock head %}
        <style>
            textarea{
                width: -webkit-fill-available !important;
                margin: 10px 0 !important;
            }
            input{
                width: -webkit-fill-available !important;
                margin: 10px 0 !important;
            }
        </style> 
    </head>
    <body dir="rtl">
    
    <main class="container">
        <div class="bg-light rounded mt-3">
            {% block content %}{% endblock content %}
        </div>
    </main>
    <nav class="navbar fixed-bottom navbar-expand-sm navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="{% url "home" %}">خواست</a>
            <button class="navbar-toggler collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
            </button>
            <div class="navbar-collapse collapse" id="navbarCollapse" style="">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <button class="btn nav-link" onclick="handleNewRequest()">درخواست جدید</a>
                </li>
                <li class="nav-item">
                    <button class="btn nav-link" onclick="handleEmergency()">شرایط اضطراری</a>
                </li>
            </ul>
            </div>
        </div>
    </nav>
    <script src="{% static 'sweetalert2.js' %}"></script>

    <script>
    function handleNewRequest() {
    Swal.fire({
        title: 'درخواست جدید',
        html:
        '<form id="swal-form" method="post">' + 
        '{% csrf_token %}' +
        '<input id="swal-title" name="title" class="swal2-input" placeholder="عنوان">' +
        '<textarea id="swal-description" name="description" class="swal2-textarea" placeholder="توضیحات"></textarea>' +
        '</form>',
        showCancelButton: true,
        confirmButtonText: 'ارسال',
        cancelButtonText: 'انصراف',
        focusConfirm: false,
        preConfirm: () => {
        const title = document.getElementById('swal-title').value.trim();
        const description = document.getElementById('swal-description').value.trim();

        if (!title || !description) {
            Swal.showValidationMessage('لطفاً عنوان و توضیحات را وارد کنید');
            return false;
        }
        return { title, description };
        }
    }).then((result) => {
        if (result.isConfirmed) {
            const form = document.getElementById('swal-form')
            form.submit()
        }
    });
    }

    function handleEmergency() {
    Swal.fire({
        title: 'شرایط اضطراری',
        text: 'آیا از انجام این عملیات اضطراری اطمینان دارید؟',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: 'بله، ادامه بده',
        cancelButtonText: 'انصراف'
    }).then((result) => {
        if (result.isConfirmed) {
        // You can trigger your emergency logic here
        Swal.fire('درخواست اضطراری ثبت شد', '', 'success');
        }
    });
    }
    </script>
    <script src="{% static 'bootstrap.bundle.min.js' %}"></script>
    {% if submit %}
    <script>Swal.fire('با موفقیت ثبت شد!', '', 'success');</script>
    {% endif %}
    {% block script %}{% endblock script %}
    <script>
        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(showPosition, handleError);
            } else {
                console.log("Geolocation is not supported by this browser.");
            }
        }

        function showPosition(position) {
            const latitude = position.coords.latitude;
            const longitude = position.coords.longitude;
            console.log(`Latitude: ${latitude}, Longitude: ${longitude}`);
            fetch('{% url "set-location" %}?c=' + latitude + ',' + longitude)
        }

        function handleError(error) {
            switch (error.code) {
                case error.PERMISSION_DENIED:
                    console.log("User denied the request for Geolocation.");
                    break;
                case error.POSITION_UNAVAILABLE:
                    console.log("Location information is unavailable.");
                    break;
                case error.TIMEOUT:
                    console.log("The request to get user location timed out.");
                    break;
                case error.UNKNOWN_ERROR:
                    console.log("An unknown error occurred.");
                    break;
            }
        }
        setInterval(() => {
            getLocation()
        }, 1000 * 60 * 5)

    </script>
    </body>
</html>